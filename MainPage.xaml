<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:firstApp"
             x:Class="firstApp.MainPage"
             Title="Movies">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:GenreToEmojiConverter x:Key="GenreToEmojiConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowSpacing="10" Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Search bar filters the CollectionView in real time -->
        <SearchBar x:Name="SearchBarControl"
                   Grid.Row="0"
                   Placeholder="Search movies..."
                   TextChanged="SearchBar_TextChanged" />

        <CollectionView x:Name="MoviesView"
                        Grid.Row="1"
                        VerticalOptions="FillAndExpand"
                        SelectionMode="Single"
                        SelectionChanged="MoviesView_SelectionChanged">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="6" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <HorizontalStackLayout Padding="8" Spacing="12" VerticalOptions="Center">
                        <!-- Use platform emoji fonts so glyphs render correctly -->
                        <Label Text="{Binding Emoji}" FontSize="28">
                            <Label.FontFamily>
                                <OnPlatform x:TypeArguments="x:String">
                                    <On Platform="WinUI" Value="Segoe UI Emoji" />
                                    <On Platform="Android" Value="Noto Color Emoji" />
                                    <On Platform="iOS" Value="Apple Color Emoji" />
                                    <On Platform="MacCatalyst" Value="Apple Color Emoji" />
                                </OnPlatform>
                            </Label.FontFamily>
                        </Label>

                        <VerticalStackLayout VerticalOptions="Center" Spacing="2">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="{Binding Title}" FontSize="16" />
                                <Label Text="{Binding Genre, Converter={StaticResource GenreToEmojiConverter}}" FontSize="16" />
                            </HorizontalStackLayout>
                            <Label Text="{Binding Director}" FontSize="12" TextColor="Gray" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Raw JSON hidden by default but kept for debugging if needed -->
        <Frame Grid.Row="2" Padding="8" BorderColor="LightGray" CornerRadius="6" IsVisible="False">
            <ScrollView HeightRequest="200">
                <Label x:Name="JsonLabel" LineBreakMode="WordWrap" />
            </ScrollView>
        </Frame>
    </Grid>

</ContentPage>
